import { Component, OnInit } from "@angular/core";
import { HttpClient, HttpHeaders } from "@angular/common/http";
import { ActivatedRoute, Router } from "@angular/router";
import { SessionService } from "../../session.service";
import { environment } from "../../../environments/environment";
import { Ng4LoadingSpinnerService } from "ng4-loading-spinner";
import * as $ from "jquery";
import Swal from "sweetalert2";
import {
  ModalDismissReasons,
  NgbModal,
  NgbModalOptions,
} from "@ng-bootstrap/ng-bootstrap";
import { FormBuilder, FormGroup, Validators } from "@angular/forms";
import { Title } from "@angular/platform-browser";
import { DatePipe } from "@angular/common";
import { UtilityService } from "src/app/utility.service";

@Component({
  selector: "app-individuals",
  templateUrl: "./individuals.component.html",
  styleUrls: ["./individuals.component.css"],
})
export class IndividualsComponent implements OnInit {
  editorRole: boolean = false;
  modalOptions: NgbModalOptions;
  dtOptions: any = {};
  dtOptionsPopUp: any = {};
  roleID: any;
  taxOfficeID: string;
  corporateId: string;
  submitted: boolean = false;
  closeResult: string;
  title = "PAYE - Individual Report";
  apiUrl: string;
  individualsData: any;
  sample_file: string;
  showTaxOffice: boolean;
  managerRole: boolean;
  showEditIndividual: boolean;
  unfilteredTaxTaxOffices: any;
  taxTaxOffices: any;
  industrySectors: any;
  myForm: FormGroup;
  columnError: string[] = [];
  file: any;
  filePath: any;
  error: string;
  addIndividualForm: FormGroup;
  retrieveAccountForm: FormGroup;
  showCreateIndividual: boolean;
  showUpdateIndividual: boolean;
  disableIndividualFormControls: boolean;
  individualTitle: string;
  isUpdateIndividual: boolean;
  isEmailVerified: boolean;
  selectedIndividual: any;
  selectedIndividualId: any;
  disableIndividualEmail: boolean = false;
  disableIndividualBVN: boolean = true;
  today: Date;
  dateInvalid: boolean;
  showUpdateIndividualEmail: boolean = false;
  config: any;
  currentPageLength: any = 10;
  showOtherTabs: boolean;
  paymentsView: boolean;
  paymentsData: any;
  detailsView: boolean;
  daPaymentsData: any;
  zipCodes: any;
  searchForm: FormGroup;

  searchObject: any = {};
  stateLocalGovts: any;
  validateCacTin: boolean;
  showFootNote: boolean = true;
  linkedAssetData: any = [];
  vehicleAsset: boolean;
  landAsset: boolean;
  buildingAsset: boolean;
  businessAsset: boolean;
  selectedAssetTypeId: any;
  assetTypes: any;
  selectedBusinessId: any;
  selectedLinkAssetTypeId: any;
  searchAssetModalRef: any;
  businessData: any = [];
  showSearchAssetButton: boolean;
  assessmentModalRef: any;
  linkAssetForm: FormGroup;
  assetTypeForm: FormGroup;
  businessForm: FormGroup;
  searchAssetForm: FormGroup;
  assessmentData: any = [];
  taxpayerRoles: any;
  selectedCorporateId: any = null;
  showLinkedAssetButton: any = false;
  selectedLandId: any;
  landData: any = [];
  showCreateAssetButton: boolean;
  selectedBuildingId: any;
  buildingData: any = [];
  linkAssetModalRef: any;
  linkAssetRequestObj: any = { };
  payeAssessmentData: any = [];
  selectedTaxpayerRoleId: string;
  disableLinkAssetFormControl: boolean;
  showSaveButton: any;
  addIndividualModalRef: any;
  whtAssessmentsData: any;
  selectedTaxpayerId: any;

  get f() {
    return this.myForm.controls;
  }

  constructor(
    private httpClient: HttpClient,
    private route: ActivatedRoute,
    private titleService: Title,
    private router: Router,
    private datepipe: DatePipe,
    private utilityService: UtilityService,
    private sess: SessionService,
    private spinnerService: Ng4LoadingSpinnerService,
    private modalService: NgbModal,
    private formBuilder: FormBuilder
  ) {}

  ngOnInit(): void {
    this.titleService.setTitle(this.title);
    this.sess.checkLogin();
    this.roleID = localStorage.getItem("admin_role_id");
    this.taxOfficeID = localStorage.getItem("admin_tax_office_id");
    this.corporateId = localStorage.getItem("admin_corporate_id");
    this.today = new Date();
    this.datepipe.transform(this.today, "dd/MM/yyyy");

    this.initialiseForms();

    if (this.roleID === "1") {
      this.showTaxOffice = true;
    }

    if (this.roleID === "2") {
      this.showTaxOffice = false;
      this.managerRole = true;
    }

    if (this.roleID === "3") {
      this.showTaxOffice = false;
      this.editorRole = true;
      this.showEditIndividual = true;
      this.showUpdateIndividualEmail = true;
    }

    /* Pagination Start */
    this.config = {
      currentPage: 1,
      itemsPerPage: 10,
    };

    this.getIndividuals(this.config.itemsPerPage, this.config.currentPage);

    this.route.queryParams.subscribe(
      (params) =>
        (this.config.currentPage = params["page"] ? params["page"] : 1)
    );

    this.intialiseTableProperties();

    this.getTaxOffices();
    this.getIndustrySectors();
    this.getZipcodes();
    this.getStateLocalGovts();
    this.getAssetTypes();
    // this.getTaxpayerRoles();

    this.myForm = this.formBuilder.group({
      myfile: ["", Validators.required],
    });

    this.sample_file =
      environment.SAMPLE_FILE_URL + "individual-taxpayers.xlsx";
    // this.getIndividuals();
  }

  getUpdatedLinkedAssets($event) {
    if ($event) {
      this.getAssetData();
      this.linkAssetModalRef.close();
    }
  }

  getUpdatedListOfIndividuals($event) {
    if ($event) {
      this.getIndividuals(this.config.itemsPerPage, this.config.currentPage);
    }
  }

  intialiseTableProperties() {
    this.modalOptions = {
      backdrop: true,
      centered: true,
      backdropClass: "customBackdrop",
      size: "xl",
    };

    this.dtOptions = {
      paging: false,
      pagingType: "full_numbers",
      responsive: true,
      pageLength: 10,
      lengthChange: false,
      processing: false,
      ordering: false,
      info: false,
      columnDefs: [
        {
          //targets: [ 10 ],
          visible: false,
          searchable: false,
        },
      ],
      dom:
        "<'row'<'col-sm-4'l><'col-sm-4 text-center'B><'col-sm-4'f>>" +
        "<'row'<'col-sm-12'tr>>" +
        "<'row'<'col-sm-5'i><'col-sm-7'p>>",
      buttons: [
        {
          extend: "csv",
          className: "btn btn-outline-dark",
          text: '<i class="fas fa-file-csv"> CSV</i>',
          exportOptions: { columns: [0, 1, 2, 3, 4, 5, 6, 7] },
        },
        {
          extend: "excel",
          className: "btn btn-outline-dark",
          text: '<i class="fas fa-file-excel"> Excel</i>',
          exportOptions: { columns: [0, 1, 2, 3, 4, 5, 6, 7] },
        },

        {
          extend: 'pdfHtml5',
          className: "btn btn-outline-dark export-btn",
          text: '<i class="fas fa-file-pdf"> PDF</i>',
          orientation: "portrait",
          pageSize: "LEGAL",
          exportOptions: {
            columns: [0, 1, 2, 3, 4, 5, 6, 7],
          },

          customize: function (doc) {
              doc.content.splice( 1, 0, {
                  margin: [ 0, 0, 0, 10 ],
                  alignment: 'left',
                  image: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAhgAAAAqCAIAAAB+y7XIAAAACXBIWXMAAAsTAAALEwEAmpwYAAA7ZWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiCiAgICAgICAgICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgICAgICAgICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgICAgICAgICB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDpkZWM4YjUzNy1jMGU5LThjNDEtYWMxNy1iYmNjZGYwNWM3Y2I8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkRvY3VtZW50SUQ+eG1wLmRpZDo1ODc5MEFDNEIzMDYxMUVCOTI2M0Q0ODdCOTEzNDU2RDwveG1wTU06RG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkluc3RhbmNlSUQ+eG1wLmlpZDoyMDQzODI5Ni1mOTQyLTM1NDctYjk4OC0wN2RiZGVjMmFhOTQ8L3htcE1NOkluc3RhbmNlSUQ+CiAgICAgICAgIDx4bXBNTTpEZXJpdmVkRnJvbSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgIDxzdFJlZjppbnN0YW5jZUlEPnhtcC5paWQ6ZGVjOGI1MzctYzBlOS04YzQxLWFjMTctYmJjY2RmMDVjN2NiPC9zdFJlZjppbnN0YW5jZUlEPgogICAgICAgICAgICA8c3RSZWY6ZG9jdW1lbnRJRD54bXAuZGlkOmRlYzhiNTM3LWMwZTktOGM0MS1hYzE3LWJiY2NkZjA1YzdjYjwvc3RSZWY6ZG9jdW1lbnRJRD4KICAgICAgICAgPC94bXBNTTpEZXJpdmVkRnJvbT4KICAgICAgICAgPHhtcE1NOkhpc3Rvcnk+CiAgICAgICAgICAgIDxyZGY6U2VxPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmFjdGlvbj5zYXZlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6aW5zdGFuY2VJRD54bXAuaWlkOjAxZGExZmY3LWU2OWQtYjI0Ni04YjQyLTE4ODUyOTIxYjE5OTwvc3RFdnQ6aW5zdGFuY2VJRD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OndoZW4+MjAyMS0wNS0xMlQxNTo0NjoyMiswNTozMDwvc3RFdnQ6d2hlbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OnNvZnR3YXJlQWdlbnQ+QWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKFdpbmRvd3MpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICAgICA8c3RFdnQ6Y2hhbmdlZD4vPC9zdEV2dDpjaGFuZ2VkPgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+c2F2ZWQ8L3N0RXZ0OmFjdGlvbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDoyMDQzODI5Ni1mOTQyLTM1NDctYjk4OC0wN2RiZGVjMmFhOTQ8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDp3aGVuPjIwMjEtMDUtMTJUMTU6NDc6MTUrMDU6MzA8L3N0RXZ0OndoZW4+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpzb2Z0d2FyZUFnZW50PkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE3IChXaW5kb3dzKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOlNlcT4KICAgICAgICAgPC94bXBNTTpIaXN0b3J5PgogICAgICAgICA8eG1wOkNyZWF0b3JUb29sPkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE3IChXaW5kb3dzKTwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8eG1wOkNyZWF0ZURhdGU+MjAyMS0wNS0xMlQxNToxMjoyMCswNTozMDwveG1wOkNyZWF0ZURhdGU+CiAgICAgICAgIDx4bXA6TW9kaWZ5RGF0ZT4yMDIxLTA1LTEyVDE1OjQ3OjE1KzA1OjMwPC94bXA6TW9kaWZ5RGF0ZT4KICAgICAgICAgPHhtcDpNZXRhZGF0YURhdGU+MjAyMS0wNS0xMlQxNTo0NzoxNSswNTozMDwveG1wOk1ldGFkYXRhRGF0ZT4KICAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9wbmc8L2RjOmZvcm1hdD4KICAgICAgICAgPHBob3Rvc2hvcDpDb2xvck1vZGU+MzwvcGhvdG9zaG9wOkNvbG9yTW9kZT4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgICAgPHRpZmY6WFJlc29sdXRpb24+NzIwMDAwLzEwMDAwPC90aWZmOlhSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpZUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WVJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDxleGlmOkNvbG9yU3BhY2U+NjU1MzU8L2V4aWY6Q29sb3JTcGFjZT4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjUzNjwvZXhpZjpQaXhlbFhEaW1lbnNpb24+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj40MjwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAo8P3hwYWNrZXQgZW5kPSJ3Ij8+Tc04UQAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAA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'
              },

            );
          }
        }
      ],
    };

    this.dtOptionsPopUp = {
      paging: true,
      // scrollX: true,
      pagingType: "full_numbers",
      responsive: true,
      pageLength: 5,
      lengthChange: true,
      processing: true,
      ordering: false,
      info: true,
      columnDefs: [
        {
          //targets: [ 10 ],
          visible: false,
          searchable: false,
        },
      ],
    };

    if (this.roleID === "1") {
      this.dtOptions.buttons = [
        {
          extend: "csv",
          className: "btn btn-outline-dark",
          text: '<i class="fas fa-file-csv"> CSV</i>',
          exportOptions: { columns: [0, 1, 2, 3, 4, 5, 6, 7, 8] },
        },
        {
          extend: "excel",
          className: "btn btn-outline-dark",
          text: '<i class="fas fa-file-excel"> Excel</i>',
          exportOptions: { columns: [0, 1, 2, 3, 4, 5, 6, 7, 8] },
        },

        {
          extend: 'pdfHtml5',
          className: "btn btn-outline-dark export-btn",
          text: '<i class="fas fa-file-pdf"> PDF</i>',
          orientation: "portrait",
          pageSize: "LEGAL",
          exportOptions: {
            columns: [0, 1, 2, 3, 4, 5, 6, 7, 8],
          },

          customize: function (doc) {
              doc.content.splice( 1, 0, {
                  margin: [ 0, 0, 0, 10 ],
                  alignment: 'left',
                  image: '',
              },

            );

            // doc.pageMargins = [ 40, 60, 40, 60 ];
          }
        }
      ];
    }
  }

  initialiseForms() {
    this.initialiseLinkAssetForm();
    this.initialiseSearchAssetForm();
    
    this.assetTypeForm = this.formBuilder.group({
      assetTypeId: ["", Validators.required],
    });

    this.addIndividualForm = this.formBuilder.group({
      emailAddress: [
        "",
        [
          Validators.maxLength(60),
          Validators.pattern(
            /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
          ),
        ],
      ],
      firstName: [
        "",
        [
          Validators.required,
          Validators.pattern(/^[a-zA-Z]+$/),
          Validators.maxLength(60),
        ],
      ],
      surname: [
        "",
        [
          Validators.required,
          Validators.pattern(/^[a-zA-Z]+$/),
          Validators.maxLength(60),
        ],
      ],
      titleId: ["", Validators.required],

      individualTIN: [
        "",
        [
          Validators.pattern(/^[0-9\s]*$/),
          Validators.minLength(10),
          Validators.maxLength(10),
        ],
      ],
      phoneNumber: [
        "",
        [
          Validators.required,
          Validators.minLength(11),
          Validators.maxLength(11),
          Validators.pattern(/^[0][1-9]\d{9}$|^[1-9]\d{9}$/),
        ],
      ],
      nationality: ["Nigerian", Validators.required],
      genderId: ["", Validators.required],
      dateOfBirth: ["", Validators.required],
      maritalStatus: ["", Validators.required],
      occupation: [
        "",
        [
          Validators.required,
          Validators.pattern("^[A-Za-z 0-9 _-]*[A-Za-z0-9][A-Za-z0-9 _]*$"),
        ],
      ],
      bvn: [
        "",
        [
          Validators.minLength(11),
          Validators.pattern(/^[0-9]*$/),
        ],
      ],
      nin: [
        "",
        [
          Validators.minLength(11),
          Validators.pattern(/^[0-9]*$/),
        ],
      ],
      contactAddress: [
        "",
        [
          Validators.required,
          Validators.maxLength(200),
          Validators.minLength(6),
          Validators.pattern(/[A-Za-z0-9'\.\-\s\,]/),
        ],
      ],
      zipCode: ["", [Validators.required]],
      taxOfficeId: ["", Validators.required],
      localGovernmentId: ["", Validators.required],
    });

    this.retrieveAccountForm = this.formBuilder.group({
      bvn: [
        "",
        [
          Validators.required,
          Validators.minLength(11),
          Validators.pattern(/^[0-9]*$/),
        ],
      ],
    });

    this.searchForm = this.formBuilder.group({
      individualTIN: [
        "",
        [
          Validators.maxLength(10),
          Validators.minLength(10),
          Validators.pattern(/^[0-9]*$/),
        ],
      ],
      taxPayerName: [''],
      registeredFromId: [''],
      taxOfficeId: [''],
    });
  }

  initialiseLinkAssetForm() {
    this.disableLinkAssetFormControl = null;

    this.linkAssetForm = this.formBuilder.group({
      assetName: [
        "",
        [
          Validators.required,
        ],
      ],
      assetTypeId: ["", Validators.required],
      taxpayerRoleId: ["", Validators.required],
    });

  }

  initialiseSearchAssetForm() {
    this.searchAssetForm = this.formBuilder.group({
      assetName: [
        "",
        [
          Validators.required,
          Validators.minLength(3),
          Validators.pattern(/^[0-9A-Za-z'-]+(?:\s[0-9A-Za-z'-]+)*$/),
          Validators.maxLength(40),
        ],
      ],
    });
  }

  getDAPayment(individualId) {
    this.spinnerService.show();
    this.daPaymentsData = "";
    this.apiUrl = environment.AUTHAPIURL + "transactions-list/individual";

    const reqHeader = new HttpHeaders({
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
    });

    const obj = {
      taxpayer_id: individualId,
    };

    this.httpClient
      .post<any>(this.apiUrl, obj, { headers: reqHeader })
      .subscribe((data) => {
        // console.log("daPaymentsApiData", data);

        if (data.status == true) {
          this.daPaymentsData = data.response.data;
        } else {
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text: data.message,
            showConfirmButton: true,
            timer: 5000,
          });

          this.daPaymentsData = [];
        }

        this.spinnerService.hide();
      });
  }

  getPayments(individualId) {
    this.paymentsData = "";
    this.apiUrl = environment.AUTHAPIURL + "individuals/paye-payments";

    const obj = {
      taxpayer_id: individualId,
    };

    const reqHeader = new HttpHeaders({
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
    });

    this.spinnerService.show();
    this.httpClient
      .post<any>(this.apiUrl, obj, { headers: reqHeader })
      .subscribe((data) => {
        // console.log("paymentsApiData", data);

        if (data.status == true) {
          this.paymentsData = data.response.data;
        } else {
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text: data.message,
            showConfirmButton: true,
            timer: 5000,
          });

          this.paymentsData = [];
        }

        this.spinnerService.hide();
      });
  }

  getTaxpayerRoles() {
    this.apiUrl = `${environment.AUTHAPIURL}asset-taxpayer/relations`;

    const reqHeader = new HttpHeaders({
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
    });

    var obj = {
      taxpayer_type: "Individual",
      asset_type_id: this.selectedLinkAssetTypeId
    }

    this.httpClient.post<any>(this.apiUrl, obj, { headers: reqHeader }).subscribe((data) => {
      this.taxpayerRoles = data.response;
      // console.log("taxpayerRoles: ", data);
    });
  }

  getIndividuals(perpage, pageno) {
    this.individualsData = "";
    this.apiUrl = `${environment.AUTHAPIURL}individuals-list?page=` + pageno;

    const reqHeader = new HttpHeaders({
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
    });

    this.searchObject["page_no"] = pageno;
    this.searchObject["per_page"] = perpage;

    this.spinnerService.show();
    this.httpClient
      .post<any>(this.apiUrl, this.searchObject, { headers: reqHeader })
      .subscribe((data) => {
        console.log("individualsApiData", data);

        if (data.status == true) {
          this.individualsData = data.response.data;
          this.config.totalItems = data.response.total;
        } else {
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text: data.message,
            showConfirmButton: true,
            timer: 5000,
          });

          this.individualsData = [];
        }

        this.spinnerService.hide();
      });
  }

  getDirectAssessments(individualId, perpage, pageno) {
    this.spinnerService.show();
    this.payeAssessmentData = '';
    this.apiUrl = `${environment.AUTHAPIURL}direct-assessments/list?page=${pageno}`;

    const reqHeader = new HttpHeaders({
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
    });

    this.searchObject["page_no"] = pageno;
    this.searchObject["per_page"] = perpage;
    this.searchObject["idividual_id"] = individualId;

    this.httpClient.post<any>(this.apiUrl, this.searchObject, { headers: reqHeader }).subscribe((data) => {
        console.log("assessmentsData: ", data);
        this.payeAssessmentData = data.response == null ? [] : data.response.data;
        this.config.totalItems = data.response.total;
        this.spinnerService.hide();
      });
  }

  getWhtAssessments(selectedTaxpeyerId, perpage, pageno) {
    this.spinnerService.show();
    this.apiUrl = `${environment.AUTHAPIURL}wht/assessments/list?page=${pageno}`;

    const reqHeader = new HttpHeaders({
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
    });

    this.searchObject["page_no"] = pageno;
    this.searchObject["per_page"] = perpage;
    this.searchObject["collector_taxpayer_id"] = selectedTaxpeyerId;

    this.httpClient.post<any>(this.apiUrl, this.searchObject, { headers: reqHeader }).subscribe((data) => {
        console.log("assessmentsData: ", data);
        this.whtAssessmentsData = data.response == null ? [] : data.response.data;
        this.config.totalItems = data.response?.total;
        this.spinnerService.hide();
    });
  }


  getTaxYear(taxDueDate: string): string {
    var taxYear = taxDueDate.split("-", 3)[0];
    return taxYear;
  }

  generateAssessment(url: string) {
    this.spinnerService.show();
    this.modalService.dismissAll();
    this.router.navigate([url]);
    // this.router.navigate(['/filedeclaration']);
    this.spinnerService.hide();
  }

  pageChange(newPage: number) {
    this.individualsData = "";
    this.router.navigate(["/individuals"], { queryParams: { page: newPage } });
    this.getIndividuals(this.config.itemsPerPage, newPage);
  }

  public setItemsPerPage(event) {
    this.config.itemsPerPage = event;
    this.currentPageLength = this.config.itemsPerPage;
    this.individualsData = "";
    this.router.navigate(["/individuals"]);
    this.getIndividuals(this.config.itemsPerPage, 1);
  }

  addIndividual(modal, showSaveButton: boolean) {
    this.individualTitle = "Add New Individual";
    this.submitted = false;
    this.showSaveButton = showSaveButton;
    this.selectedIndividualId = null;
    this.showCreateIndividual = true;
    this.showUpdateIndividual = false;
    this.disableIndividualEmail = null;
    this.disableIndividualBVN = null;
    this.showOtherTabs = false;
    this.initialiseForms();
    this.disableIndividualFormControls = null;
    // this.utilityService.showModal(modal);
    this.addIndividualModalRef = this.utilityService.openModal(modal);
  }

  createIndividual() {
    this.isUpdateIndividual = false;
  }

  updateIndividual() {
    this.isUpdateIndividual = true;
  }

  retrieveIndividual(modal) {
    
    this.initialiseForms();
    this.retrieveAccountForm = this.formBuilder.group({
      bvn: [
        "",
        [
          Validators.required,
          Validators.minLength(11),
          Validators.pattern(/^[0-9]*$/),
        ],
      ],
    });
    this.utilityService.showModal(modal);
  }

  setIndividualEmail() {
    if (this.roleID === "1") {
      this.disableIndividualEmail = null;
    } else {
      this.disableIndividualEmail = true;
    }
  }

  checkDate(event) {
    let dateLimit = new Date();
    console.log("event: ", event);

    if (
      Date.parse(event) < dateLimit.setFullYear(1960, 1, 1) ||
      Date.parse(event) > dateLimit.setFullYear(2021, 1, 1)
    ) {
      this.dateInvalid = true;
    } else {
      this.dateInvalid = false;
    }
  }

  validateTinPhoneNinBvn(selectedForm) {
    let tin = selectedForm.get('individualTIN').value;
    let nin = selectedForm.get('nin').value;
    let bvn = selectedForm.get('bvn').value;

    if ((tin == "" || tin == null) && (nin == "" || nin == null) && (bvn == "" || bvn == null)) 
    {
      this.validateCacTin = true;
    }
    else {
      this.validateCacTin = false;
    }
  }

  changeTinPhoneNinBvnStatus() {
    this.validateCacTin = false;
  }

  onSubmitAddIndividual(formData: any) {
    this.submitted = true;
    console.log("isUpdateIndividual: ", this.isUpdateIndividual);

    let dateLimit = new Date();
    if (Date.parse(formData.dateOfBirth) < dateLimit.setFullYear(1960, 1, 1)) {
      this.dateInvalid = true;
      return;
    } else {
      this.dateInvalid = false;
    }

    // stop the process here if form is invalid
    this.validateTinPhoneNinBvn(this.addIndividualForm);

    if (this.addIndividualForm.invalid || this.validateCacTin) {
      return;
    }

    var requestObj = {
      title: formData.titleId,
      first_name: formData.firstName,

      surname: formData.surname,
      email: formData.emailAddress,
      bvn: formData.bvn,
      tin: formData.individualTIN,
      phone: formData.phoneNumber,
      gender: formData.genderId,
      nationality: formData.nationality,
      date_of_birth: formData.dateOfBirth,
      marital_status: formData.maritalStatus,
      occupation: formData.occupation,
      home_address: formData.contactAddress,
      individual_id: this.selectedIndividualId,
      zip_code: formData.zipCode,
      lga_code: formData.localGovernmentId,

      nin: formData.nin,
    };

    console.log("individualPostObjData: ", requestObj);

    if (this.isUpdateIndividual) {
      requestObj['tax_office_id'] = formData.taxOfficeId;
      this.postUpdateIndividualData(requestObj);
    } else {
      this.postAddIndividualData(requestObj);
    }
    // }

    this.submitted = false;
  }

  postAddIndividualData(jsonData: any) {
    this.apiUrl = environment.AUTHAPIURL + "individuals/create";
    this.spinnerService.show();

    const reqHeader = new HttpHeaders({
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
    });

    this.httpClient
      .post<any>(this.apiUrl, jsonData, { headers: reqHeader })
      .subscribe((data) => {
        console.log(data);

        if (data.status == true) {
          // Rest form fithout errors
          this.submitted = false;
          this.addIndividualForm.reset();
          Object.keys(this.addIndividualForm.controls).forEach((key) => {
            this.addIndividualForm.get(key).setErrors(null);
          });

          Swal.fire({
            icon: "success",
            title: "Success",
            text:
              data.response != null && data.response[0] != undefined
                ? data.response[0].message
                : data.message,
            showConfirmButton: true,
            timer: 5000,
          });
          this.utilityService.closeAllModals();
          this.getIndividuals(
            this.config.itemsPerPage,
            this.config.currentPage
          );
          // this.getIndividuals();
          this.initialiseForms();
          this.spinnerService.hide();
        } else {
          this.spinnerService.hide();
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text:
              data.response != null && data.response[0] != undefined
                ? data.response[0].message
                : data.message,
            showConfirmButton: true,
            timer: 5000,
          });
        }
      });
  }

  postUpdateIndividualData(jsonData: any) {
    this.apiUrl = `${environment.AUTHAPIURL}individuals-update`;

    const reqHeader = new HttpHeaders({
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
    });

    this.spinnerService.show();
    this.httpClient
      .post<any>(this.apiUrl, jsonData, { headers: reqHeader })
      .subscribe((data) => {
        console.log(data);

        if (data.status == true) {
          // Rest form fithout errors
          this.submitted = false;
          this.addIndividualForm.reset();
          // this.addIndividualForm.get('nationality').setValue('Nigerian');
          Object.keys(this.addIndividualForm.controls).forEach((key) => {
            this.addIndividualForm.get(key).setErrors(null);
          });

          Swal.fire({
            icon: "success",
            title: "Success",
            text:
              data.response != null && data.response[0] != undefined
                ? data.response[0].message
                : data.message,
            showConfirmButton: true,
            timer: 5000,
          });
          this.utilityService.closeAllModals();
          this.getIndividuals(
            this.config.itemsPerPage,
            this.config.currentPage
          );
          // this.getIndividuals();
          this.initialiseForms();
          this.spinnerService.hide();
        } else {
          this.spinnerService.hide();
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text:
              data.response != null && data.response[0] != undefined
                ? data.response[0].message
                : data.message,
            showConfirmButton: true,
            timer: 5000,
          });
        }
      });
  }

  viewIndividual(modal, selectedIndividual, showSaveButton: boolean) {
    // console.log("selectedIndividual: ", selectedIndividual);
    this.submitted = false;
    this.showSaveButton = showSaveButton;
    this.changeTinPhoneNinBvnStatus();
    this.showCreateAssetButton = false;
    this.showCreateIndividual = false;
    this.showUpdateIndividual = false;
    this.showLinkedAssetButton = false;
    this.individualTitle = "View Individual Details";
    this.disableIndividualFormControls = true;
    this.disableIndividualEmail = true;
    this.disableIndividualBVN = true;
    this.selectedIndividualId = selectedIndividual.id;
    this.selectedTaxpayerId = selectedIndividual.taxpayer_id;

    this.showOtherTabs = true;
    this.getSingleIndividual(selectedIndividual.id, false);
    this.getDirectAssessments(this.selectedIndividualId, this.config.itemsPerPage, 1);
    this.getWhtAssessments(this.selectedTaxpayerId, this.config.itemsPerPage, 1);
    this.utilityService.showModal(modal);
    this.getAssetData();
  }

  editIndividual(modal, selectedIndividual, showSaveButton: boolean) {
    // console.log("selectedIndividual: ", selectedIndividual);
    this.submitted = false;
    this.showSaveButton = null;
    this.changeTinPhoneNinBvnStatus();
    this.showCreateIndividual = false;
    this.showUpdateIndividual = true;
    this.individualTitle = "Edit Individual Details";
    this.selectedIndividualId = selectedIndividual.id;
    this.disableIndividualFormControls = null;
    this.disableIndividualEmail = true;
    this.disableIndividualBVN = true;
    this.isEmailVerified =
      selectedIndividual.has_valid_email == 0 ? null : true;
    this.showOtherTabs = false;
    this.getSingleIndividual(selectedIndividual.id, false);
    this.addIndividualModalRef = this.utilityService.openModal(modal);
  }

  showModal(modal) {
    this.utilityService.showModal(modal);
  }

  getSingleIndividual(individualId, isUpdateEmail: boolean) {
    this.detailsView = true;
    this.spinnerService.show();
    this.apiUrl = `${environment.AUTHAPIURL}individuals/${individualId}/show`;

    const reqHeader = new HttpHeaders({
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
    });

    this.httpClient
      .get<any>(this.apiUrl, { headers: reqHeader })
      .subscribe((data) => {
        // console.log("singleIndividualData: ", data);
        this.selectedIndividual = data.response;

        this.loadSelectedCorporateData(this.selectedIndividual, isUpdateEmail);
        this.getPayments(this.selectedIndividual.taxpayer_id);
        this.getDAPayment(this.selectedIndividual.taxpayer_id);
        this.spinnerService.hide();
      });
  }

  loadSelectedCorporateData(selectedIndividual, isUpdateEmail: boolean) {
    // console.log("th: ", this.disableIndividualFormControls);

    if (isUpdateEmail) {
    } else {
      this.addIndividualForm = this.formBuilder.group({
        emailAddress: [
          selectedIndividual.email,
          [
            Validators.maxLength(60),
            Validators.pattern(
              /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
            ),
          ],
        ],
        firstName: [
          selectedIndividual.first_name,
          [
            Validators.required,
            Validators.pattern(/^[a-zA-Z]+$/),
            Validators.maxLength(60),
          ],
        ],
        surname: [
          selectedIndividual.surname,
          [
            Validators.required,
            Validators.pattern(/^[a-zA-Z]+$/),
            Validators.maxLength(60),
          ],
        ],
        titleId: [selectedIndividual.title, Validators.required],

        individualTIN: [
          selectedIndividual.tin,
          [
            Validators.pattern(/^[0-9\s]*$/),
            Validators.minLength(10),
            Validators.maxLength(10),
          ],
        ],
        phoneNumber: [
          selectedIndividual.phone,
          [
            Validators.required,
            Validators.minLength(11),
            Validators.maxLength(11),
            Validators.pattern(/^[0][1-9]\d{9}$|^[1-9]\d{9}$/),
          ],
        ],
        nationality: [selectedIndividual.nationality, Validators.required],
        genderId: [selectedIndividual.gender, Validators.required],
        dateOfBirth: [selectedIndividual.date_of_birth, Validators.required],
        maritalStatus: [selectedIndividual.marital_status, Validators.required],
        occupation: [
          selectedIndividual.occupation,
          [
            Validators.required,
            Validators.pattern("^[A-Za-z 0-9 _-]*[A-Za-z0-9][A-Za-z0-9 _]*$"),
          ],
        ],
        bvn: [
          selectedIndividual.bvn,
          [
            Validators.minLength(11),
            Validators.pattern(/^[0-9]*$/),
          ],
        ],
        nin: [
          selectedIndividual.nin,
          [
            Validators.minLength(11),
            Validators.pattern(/^[0-9]*$/),
          ],
        ],
        contactAddress: [
          selectedIndividual.home_address,
          [
            Validators.required,
            Validators.maxLength(200),
            Validators.minLength(6),
            Validators.pattern(/[A-Za-z0-9'\.\-\s\,]/),
          ],
        ],
        zipCode: [
          selectedIndividual.zip_code == null
            ? ""
            : selectedIndividual.zip_code,
          [Validators.required],
        ],
        taxOfficeId: [
          selectedIndividual.tax_office_id == null
            ? ""
            : selectedIndividual.tax_office_id,
          [Validators.required],
        ],
        localGovernmentId: [
          selectedIndividual.lga_code == null
            ? ""
            : selectedIndividual.lga_code,
          [Validators.required],
        ],
      });
    }
  }

  uploadBulkIndividuals(modal) {
    this.utilityService.showModal(modal);
  }

  getTaxOffices() {
    this.apiUrl = environment.AUTHAPIURL + "tax-offices";

    this.httpClient.get<any>(this.apiUrl).subscribe((data) => {
      console.log("taxTaxOffices: ", data);
      this.unfilteredTaxTaxOffices = data.response;

      if (this.roleID === "1") {
        this.taxTaxOffices = this.unfilteredTaxTaxOffices;
      } else {
        this.taxTaxOffices = this.unfilteredTaxTaxOffices;
      }
    });
  }

  getIndustrySectors() {
    this.apiUrl = environment.AUTHAPIURL + "industry-sectors";

    this.httpClient.get<any>(this.apiUrl).subscribe((data) => {
      console.log("industrySectors: ", data);
      this.industrySectors = data.response;
    });
  }

  getZipcodes() {
    this.apiUrl = environment.AUTHAPIURL + "postalcodes";

    this.httpClient.get<any>(this.apiUrl).subscribe((data) => {
      console.log("zipcodes: ", data);
      this.zipCodes = data.response;
    });
  }

  getStateLocalGovts() {
    // this.stateLocalGovts = this.utilityService.getStateLocalGovts();
    this.apiUrl = `${environment.AUTHAPIURL}local-governments`;

    this.httpClient.get<any>(this.apiUrl).subscribe((data) => {
      this.stateLocalGovts = data.response;
      console.log("stateLocalGovts: ", data);
    });
  }

  viewEmploymentHistory(data) {}

  updateIndividualEmail(modal, selectedIndividual, showSaveButton) {
    console.log("showSaveButton: ", showSaveButton);
    console.log("selectedIndividual: ", selectedIndividual);
    this.showCreateIndividual = false;
    this.showSaveButton = showSaveButton;
    this.showUpdateIndividual = true;
    this.individualTitle = "Edit Individual Details";
    this.selectedIndividualId = selectedIndividual.id;
    this.disableIndividualFormControls = true;
    this.disableIndividualEmail = null;
    this.disableIndividualBVN = true;
    this.isEmailVerified =
      selectedIndividual.has_valid_email == 0 ? null : true;
    this.showOtherTabs = false;
    this.getSingleIndividual(selectedIndividual.id, false);
    this.addIndividualModalRef = this.utilityService.openModal(modal);
  }

  submit() {
    this.submitted = true;

    if (this.myForm.invalid) {
      return;
    }

    // tslint:disable-next-line: max-line-length
    // In Angular 2+, it is very important to leave the Content-Type empty. If you set the 'Content-Type' to 'multipart/form-data' the upload will not work !
    const config = {
      headers: {
        Accept: "application/json",
        Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
      },
    };

    const formData = new FormData();
    formData.append("taxpayers_file", this.myForm.get("myfile").value);
    this.apiUrl = `${environment.AUTHAPIURL}individuals/import`;
    this.spinnerService.show();

    this.httpClient
      .post<any>(this.apiUrl, formData, config)
      .subscribe((res) => {
        console.log(res);

        // Clear form Value Without any Error
        this.myForm.reset();
        Object.keys(this.myForm.controls).forEach((key) => {
          this.myForm.get(key).setErrors(null);
        });

        if (res.status == true) {
          this.myForm.reset();

          Object.keys(this.myForm.controls).forEach((key) => {
            this.myForm.get(key).setErrors(null);
          });

          this.file = null;
          this.filePath = null;

          if (res.message === "0 Corporate created; 0 updated.") {
            Swal.fire({
              icon: "error",
              title: "Error",
              text: "Confirm the file content and try again",
              showConfirmButton: true,
              timer: 5000,
            });
          } else {
            Swal.fire({
              icon: "success",
              title: "Success",
              text: res.message,
              showConfirmButton: true,
              timer: 5000,
            });

            // this.getIndividuals();
            this.getIndividuals(
              this.config.itemsPerPage,
              this.config.currentPage
            );
            this.spinnerService.hide();
            this.utilityService.closeAllModals();
          }
        } else {
          this.spinnerService.hide();
          this.myForm.reset();

          Object.keys(this.myForm.controls).forEach((key) => {
            this.myForm.get(key).setErrors(null);
          });

          const regex = /_/g;

          if (res.response != null) {
            for (const key of Object.keys(res.response)) {
              const row = res.response[key];
              // console.log("row: ", row);

              for (const error of row) {
                // console.log(key.replace(regex, ' ') + ':', error);
                let err = key.replace(regex, " " + ":");
                this.error =
                  err.toUpperCase() +
                  " " +
                  (key.replace(regex, " ") + ":", error);
                this.columnError.push(this.error);
                // console.log(this.error);
              }
            }
          }

          this.file = null;
          this.filePath = null;
          this.reload();

          Swal.fire({
            icon: "error",
            title: res.message,
            html:
              '<div class="text-left ml-3">' +
              this.columnError.join("<br />") +
              "</div>",
            showConfirmButton: true,
            timer: 25000,
          });

          this.columnError = [];
        }
      });

    this.submitted = false;
  }

  onSubmitRetrieveAccount(formData) {
    this.submitted = true;

    if (this.retrieveAccountForm.invalid) {
      return;
    }

    const config = {
      headers: {
        Accept: "application/json",
        Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
      },
    };

    const obj = {
      bvn: formData.bvn,
      existing_taxpayer: true,
    };

    this.apiUrl = environment.AUTHAPIURL + "individuals/create";

    this.spinnerService.show();
    this.httpClient.post<any>(this.apiUrl, obj, config).subscribe((data) => {
      this.spinnerService.hide();

      if (data.status == true) {
        Swal.fire({
          icon: "success",
          title: "Success",
          text:
            "Account Created Successfully, Please Check your Email and verify your account!",
          showConfirmButton: true,
          timer: 5000,
        });

        // this.getIndividuals();
        this.getIndividuals(this.config.itemsPerPage, this.config.currentPage);
        this.initialiseForms();
        // this.router.navigate(["/login"]);
      } else {
        Swal.fire({
          icon: "error",
          title: "Oops...",
          text:
            data.response[0].message != null
              ? data.response[0].message
              : data.message,
          showConfirmButton: true,
          timer: 5000,
        });
      }
    });

    this.submitted = false;
  }

  showLinkAssetModal(modal) {
    this.taxpayerRoles = '';
    this.showSearchAssetButton = false;
    this.initialiseLinkAssetForm();
    this.linkAssetModalRef = this.utilityService.openModal(modal);
  }
  
  showCreateAssessmentModal(modal) {
    this.resetAssets();
    this.searchAssetModalRef.close();
    this.assessmentModalRef = this.utilityService.openModal(modal);

    if (this.selectedLinkAssetTypeId !== null) {
      console.log("selectedAssetTypeId1: ", this.selectedLinkAssetTypeId);
      this.assetTypeForm = this.formBuilder.group({
        assetTypeId: [this.selectedLinkAssetTypeId, Validators.required],
      });

      this.onAssetTypeChange(this.selectedLinkAssetTypeId);
    }
  }

  showSearchAssetModal(modal) {
    this.businessData = ''; this.landData = ''; this.buildingData = '';
    this.initialiseSearchAssetForm();
    this.showCreateAssetButton = false;
    this.searchAssetModalRef = this.utilityService.openModal(modal);
  }

  getAssetData() {
    this.linkedAssetData = '';
    this.apiUrl = `${environment.AUTHAPIURL}assets/index`;

    const reqHeader = new HttpHeaders({
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
    });

    var jsonData = {
      individual_id: this.selectedIndividualId
    }

    this.httpClient.post<any>(this.apiUrl, jsonData, { headers: reqHeader }).subscribe((data) => {
        console.log("linkedAssetData: ", data);

        if (data.status == true) {
          this.linkedAssetData = data.response.data;
          this.spinnerService.hide();
        } 
        else {
          this.spinnerService.hide();
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text:
              data.response != null && data.response[0] != undefined
                ? data.response[0].message
                : data.message,
            showConfirmButton: true,
            timer: 5000,
          });
        }
      });
  }

  onLinkAssetTypeSelect(value) {
    console.log("selectedLinkAssetTypeId", value);
    this.selectedTaxpayerRoleId = "";
    this.selectedLinkAssetTypeId = value;
    this.toggleSearchTaxpayerButton();
    this.getTaxpayerRoles();
  }

  onLinkTaxpayerRoleSelect(value) {
    this.selectedTaxpayerRoleId = value;
    this.toggleSearchTaxpayerButton();
  }

  toggleSearchTaxpayerButton() {
    if ((this.selectedLinkAssetTypeId !== "" && this.selectedLinkAssetTypeId !== undefined) && (this.selectedTaxpayerRoleId !== "" && this.selectedTaxpayerRoleId !== undefined)) {
      this.showSearchAssetButton = true;
    }
    else {
      this.showSearchAssetButton = false;
    }
  }

  onSubmitSearchAsset(formData: any) {
    this.submitted = true;
    console.log("selectedLinkAssetTypeId: ", this.selectedLinkAssetTypeId);

    // stop the process here if form is invalid
    if (this.searchAssetForm.invalid) {
      return;
    }

    if (this.selectedLinkAssetTypeId == "1") {
      var businessRequestObj = {
        business_name: formData.assetName,
      };

      this.postSearchBusinessData(businessRequestObj);
    }

    if (this.selectedLinkAssetTypeId == "2") {
      var landRequestObj = {
        land_name: formData.assetName,
      };

      this.postSearchLandData(landRequestObj);
    }

    // if (this.selectedLinkAssetTypeId == "3") {
    //   Swal.fire({
    //     icon: "info",
    //     title: "Info",
    //     text: "Asset type 'Vehicle is not available yet!",
    //     showConfirmButton: true,
    //     timer: 5000,
    //   });

    //   //return; // not available yet
    // }

    if (this.selectedLinkAssetTypeId == "3") {
      var buildingRequestObj = {
        building_name: formData.assetName,
      };

      this.postSearchBuildingData(buildingRequestObj);
    }

    // console.log("searchAssetPostObjData: ", requestObj);
    this.submitted = false;
  }

  postSearchBusinessData(jsonData: any) {
    this.apiUrl = `${environment.AUTHAPIURL}businesses/index`;

    const reqHeader = new HttpHeaders({
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
    });

    this.spinnerService.show();
    this.httpClient.post<any>(this.apiUrl, jsonData, { headers: reqHeader }).subscribe((data) => {
        console.log(data);

        if (data.status == true) {
          // Rest form fithout errors
          Object.keys(this.searchAssetForm.controls).forEach((key) => {
            this.searchAssetForm.get(key).setErrors(null);
          });

          this.businessData = data.response.data;
          this.showCreateAssetButton = this.businessData.length > 0 ? false : true;

          if (this.businessData.length == 0) {
            Swal.fire({
              icon: "info",
              title: "Info",
              text: "No business found for the search!",
              showConfirmButton: true,
              timer: 5000,
            });
          }
          else {
            Swal.fire({
              icon: "success",
              title: "Success",
              text:
                data.response != null && data.response[0] != undefined
                  ? data.response[0].message
                  : data.message,
              showConfirmButton: true,
              timer: 5000,
            });
  
          }

          // console.log("showCreateAssetButton", this.showCreateAssetButton);
          this.reInitialiseLinkAssetForm("");
          this.spinnerService.hide();
        } 
        else {
          this.spinnerService.hide();

          Swal.fire({
            icon: "error",
            title: "Oops...",
            text:
              data.response != null && data.response[0] != undefined
                ? data.response[0].message
                : data.message,
            showConfirmButton: true,
            timer: 5000,
          });
        }
      });
  }

  postSearchLandData(jsonData: any) {
    this.apiUrl = `${environment.AUTHAPIURL}lands/index`;

    const reqHeader = new HttpHeaders({
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
    });

    this.spinnerService.show();
    this.httpClient.post<any>(this.apiUrl, jsonData, { headers: reqHeader }).subscribe((data) => {
        console.log(data);

        if (data.status == true) {
          // Rest form fithout errors
          Object.keys(this.searchAssetForm.controls).forEach((key) => {
            this.searchAssetForm.get(key).setErrors(null);
          });

          this.landData = data.response.data;
          this.showCreateAssetButton = this.landData.length > 0 ? false : true;

          if (this.landData.length == 0) {
            Swal.fire({
              icon: "info",
              title: "Info",
              text: "No land found for the search!",
              showConfirmButton: true,
              timer: 5000,
            });
          }
          else {
            Swal.fire({
              icon: "success",
              title: "Success",
              text:
                data.response != null && data.response[0] != undefined
                  ? data.response[0].message
                  : data.message,
              showConfirmButton: true,
              timer: 5000,
            });
          }

          // console.log("showCreateAssetButton", this.showCreateAssetButton);
          this.reInitialiseLinkAssetForm("");
          this.spinnerService.hide();
        } 
        else {
          this.spinnerService.hide();

          Swal.fire({
            icon: "error",
            title: "Oops...",
            text:
              data.response != null && data.response[0] != undefined
                ? data.response[0].message
                : data.message,
            showConfirmButton: true,
            timer: 5000,
          });
        }
      });
  }

  postSearchBuildingData(jsonData: any) {
    this.apiUrl = `${environment.AUTHAPIURL}buildings`;

    const reqHeader = new HttpHeaders({
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
    });

    this.spinnerService.show();
    this.httpClient.post<any>(this.apiUrl, jsonData, { headers: reqHeader }).subscribe((data) => {
        // console.log(data);

        if (data.status == true) {
          // Rest form fithout errors
          Object.keys(this.searchAssetForm.controls).forEach((key) => {
            this.searchAssetForm.get(key).setErrors(null);
          });

          this.buildingData = data.response.data;
          this.showCreateAssetButton = this.buildingData.length > 0 ? false : true;

          if (this.buildingData.length == 0) {
            Swal.fire({
              icon: "info",
              title: "Info",
              text: "No building found for the search!",
              showConfirmButton: true,
              timer: 5000,
            });
          }
          else {
            Swal.fire({
              icon: "success",
              title: "Success",
              text:
                data.response != null && data.response[0] != undefined
                  ? data.response[0].message
                  : data.message,
              showConfirmButton: true,
              timer: 5000,
            });
          }

          // console.log("showCreateAssetButton", this.showCreateAssetButton);
          this.reInitialiseLinkAssetForm("");
          this.spinnerService.hide();
        } 
        else {
          this.spinnerService.hide();

          Swal.fire({
            icon: "error",
            title: "Oops...",
            text:
              data.response != null && data.response[0] != undefined
                ? data.response[0].message
                : data.message,
            showConfirmButton: true,
            timer: 5000,
          });
        }
      });
  }

  selectBusiness(selectedBusiness) {
    console.log(selectedBusiness);
    this.disableLinkAssetFormControl = true;
    this.selectedBusinessId = selectedBusiness.id;

    this.reInitialiseLinkAssetForm(selectedBusiness.business_name);
    this.searchAssetModalRef.close();
  }

  selectLand(selectedLand) {
    console.log(selectedLand);
    this.disableLinkAssetFormControl = true;
    this.selectedLandId = selectedLand.id;

    this.reInitialiseLinkAssetForm(selectedLand.land_name);
    this.searchAssetModalRef.close();
  }

  selectBuilding(selectedBuilding) {
    console.log(selectedBuilding);
    this.disableLinkAssetFormControl = true;
    this.selectedBuildingId = selectedBuilding.id;

    this.reInitialiseLinkAssetForm(selectedBuilding.building_name);
    this.searchAssetModalRef.close();
  }
  
  reInitialiseLinkAssetForm(assetName) {
    this.linkAssetForm = this.formBuilder.group({
      assetName: [
        assetName,
        [
          Validators.required,
        ],
      ],
      assetTypeId: [this.selectedLinkAssetTypeId, Validators.required],
      taxpayerRoleId: [this.selectedTaxpayerRoleId, Validators.required],
    });

  }

  onSubmitLinkAsset(formData: any) {
    this.submitted = true;

    // stop the process here if form is invalid
    if (this.linkAssetForm.invalid) {
      return;
    }

    this.linkAssetRequestObj = {
      taxpayer_role_id: formData.taxpayerRoleId,
      individual_id: this.selectedIndividualId,
    }

    if (this.selectedLinkAssetTypeId == 1) {
      this.linkAssetRequestObj["business_id"] = this.selectedBusinessId;
    }

    
    if (this.selectedLinkAssetTypeId == 2) {
      this.linkAssetRequestObj["land_id"] = this.selectedLandId;
    }

    if (this.selectedLinkAssetTypeId == 3) {
      this.linkAssetRequestObj["building_id"] = this.selectedBuildingId;
    }

    console.log("linkAssetPostObjData: ", this.linkAssetRequestObj);
    this.postLinkAssetData(this.linkAssetRequestObj);
  }

  postLinkAssetData(jsonData: any) {
    this.apiUrl = `${environment.AUTHAPIURL}asset-taxpayer/link`;

    const reqHeader = new HttpHeaders({
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
    });

    this.httpClient.post<any>(this.apiUrl, jsonData, { headers: reqHeader }).subscribe((data) => {
        console.log(data);

        if (data.status == true) {
          // Rest form fithout errors
          Object.keys(this.linkAssetForm.controls).forEach((key) => {
            this.linkAssetForm.get(key).setErrors(null);
          });

          Swal.fire({
            icon: "success",
            title: "Success",
            text:
              data.response != null && data.response[0] != undefined
                ? data.response[0].message
                : data.message,
            showConfirmButton: true,
            timer: 5000,
          });

          this.spinnerService.hide();
        } 
        else {
          this.spinnerService.hide();

          Swal.fire({
            icon: "error",
            title: "Oops...",
            text:
              data.response != null && data.response[0] != undefined
                ? data.response[0].message
                : data.message,
            showConfirmButton: true,
            timer: 5000,
          });
        }
      });
  }

  getAssetTypes() {
    this.apiUrl = `${environment.AUTHAPIURL}asset/types`;

    const reqHeader = new HttpHeaders({
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
    });

    this.httpClient.get<any>(this.apiUrl, { headers: reqHeader }).subscribe((data) => {
      // console.log("businessItems: ", data);
      this.assetTypes = data.response;
     
    });
  }

  onAssetTypeChange(id) {
    this.selectedAssetTypeId = id;
    // this.selectedAssetTypeName = value;
    // businessAsset - 1, landAsset - 2, vehicleAsset - 3, buildingAsset - 4

    if (id == "1") {
      this.businessAsset = true;
      this.buildingAsset = false;
      this.landAsset = false;
      this.vehicleAsset = false;
    } 
    else if (id == "2") {
      this.businessAsset = false;
      this.buildingAsset = false;
      this.landAsset = true;
      this.vehicleAsset = false;
    } 
    else if (id == "3") {
      this.businessAsset = false;
      this.buildingAsset = true;
      this.landAsset = false;
      this.vehicleAsset = false;
    }
    // else if (id == "4") {
    //   this.businessAsset = false;
    //   this.buildingAsset = false;
    //   this.landAsset = false;
    //   this.vehicleAsset = true;
    // }
  }

  resetAssets() {
    this.businessAsset = false;
    this.buildingAsset = false;
    this.landAsset = false;
    this.vehicleAsset = false;
  }

  viewAsset(selectedAsset, modal) {
    console.log("selectedAsset: ", selectedAsset);

    if (selectedAsset.asset_type_name == "Business") {
      this.selectedBusinessId = selectedAsset.business_primary_id;
      this.onAssetTypeChange(1);
    }

    if (selectedAsset.asset_type_name == "Land") {
      this.selectedLandId = selectedAsset.land_primary_id;
      this.onAssetTypeChange(2);
    }

    if (selectedAsset.asset_type_name == "Building") {
      this.selectedBuildingId = selectedAsset.building_primary_id;
      this.onAssetTypeChange(4);
    }

    this.showModal(modal);
  }

  unlinkAsset(selectedAsset) {
    var obj = {};

    if (selectedAsset.asset_type_name == "Business") {
      obj = {
        business_id: selectedAsset.business_primary_id,
        individual_id: this.selectedIndividualId
      }
    }

    if (selectedAsset.asset_type_name == "Land") {
      obj = {
        land_id: selectedAsset.land_primary_id,
        individual_id: this.selectedIndividualId
      }
    }

    if (selectedAsset.asset_type_name == "Building") {
      obj = {
        building_id: selectedAsset.building_primary_id,
        individual_id: this.selectedIndividualId
      }
    }

    Swal.fire({
      title: "Are you sure?",
      text: "You won't be able to revert this!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#3085d6",
      cancelButtonColor: "#d33",
      confirmButtonText: "Yes, unlink it!",
    }).then((result) => {
      if (result.value) {
        this.postUnlinkAsset(obj);
      }
    });

  }

  postUnlinkAsset(objData) {
    this.apiUrl = `${environment.AUTHAPIURL}asset-taxpayer/unlink`;

    const reqHeader = new HttpHeaders({
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
    });

    this.httpClient.post<any>(this.apiUrl, objData, { headers: reqHeader }).subscribe((data) => {
        if (data.status == true) {
          Swal.fire({
            icon: "success",
            title: "Success",
            text: "Asset has been unlinked successfully",
            showConfirmButton: true,
            timer: 5000,
          });
          this.getAssetData();
          this.spinnerService.hide();
        } 
        else {
          this.spinnerService.hide();
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text:
              data.response != null && data.response[0] != undefined
                ? data.response[0].message
                : data.message,
            showConfirmButton: true,
            timer: 5000,
          });
        }
      });
  }

  reload() {
    this.router.routeReuseStrategy.shouldReuseRoute = () => false;
    this.router.onSameUrlNavigation = "reload";
    this.router.navigate(["./"], { relativeTo: this.route });
  }

  showFooterNote() {
    this.showFootNote = true;
  }

  hideFooterNote(showLinkedAssetButton) {
    this.showFootNote = false;

    if (this.roleID === "2" || this.roleID === "3") {
      this.showLinkedAssetButton = showLinkedAssetButton;
    }
  }

  onFileChange(event) {
    if (event.target.files.length > 0) {
      const file = event.target.files[0];
      this.file = event.target.files[0];
      this.filePath = event.target.files[0].name;
      this.myForm.get("myfile").setValue(file);
    }
  }

  onSubmitSearch(formAllData: any) {
    this.submitted = true;

    // stop the process here if form is invalid
    if (this.searchForm.invalid) {
      return;
    }

    this.searchObject = {
      tin: formAllData.individualTIN,
      taxpayer_name: formAllData.taxPayerName,
      created_by_app_id: formAllData.registeredFromId,
      tax_office_id: formAllData.taxOfficeId,
    };

    console.log('searchFormData: ', this.searchObject);
    this.getIndividuals(this.config.itemsPerPage, this.config.currentPage);
  }

  clearSearch() {
    this.individualsData = '';
    this.searchObject = {};
    this.initialiseForms();
    this.getIndividuals(this.config.itemsPerPage, this.config.currentPage);
  }

  toggleStatus(selectedIndividual) {
    var obj = {
      individual_id: selectedIndividual.id
    }

    if (selectedIndividual.active_status == 'active') {
      obj["active_status"] = 'inactive';
    }
    else {
      obj["active_status"] = 'active';
    }

    Swal.fire({
      title: "Are you sure?",
      text: "You won't be able to revert this!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#3085d6",
      cancelButtonColor: "#d33",
      confirmButtonText: "Yes, perform action!",
    }).then((result) => {
      if (result.value) {
        this.postToggleStatus(obj);
      }
    });
    
  }

  postToggleStatus(requestObj) {
    this.apiUrl = `${environment.AUTHAPIURL}taxpayer/toggle-active`;

    const reqHeader = new HttpHeaders({
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("admin_access_token"),
    });

    this.spinnerService.show();
    this.httpClient.post<any>(this.apiUrl, requestObj, { headers: reqHeader }).subscribe((data) => {
      if (data.status == true) {
        Swal.fire({
          icon: "success",
          title: "Success",
          text:
            data.response != null && data.response[0] != undefined
              ? data.response[0].message
              : data.message,
          showConfirmButton: true,
          timer: 5000,
        });
        this.getIndividuals(this.config.itemsPerPage, this.config.currentPage);
        this.spinnerService.hide();
      } 
      else {
        this.spinnerService.hide();

        Swal.fire({
          icon: "error",
          title: "Oops...",
          text:
            data.response != null && data.response[0] != undefined
              ? data.response[0].message
              : data.message,
          showConfirmButton: true,
          timer: 5000,
        });
      }
    });

  }

}
